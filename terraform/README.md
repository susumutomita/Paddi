# Paddi Terraform ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£

ã“ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã¯ã€Paddiã®ãƒ‡ãƒ¢ç’°å¢ƒã‚’è‡ªå‹•æ§‹ç¯‰ã™ã‚‹ãŸã‚ã®Terraformã‚³ãƒ¼ãƒ‰ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚

## ğŸ¯ æ¦‚è¦

Paddiã¯ã€GCPã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç›£æŸ»ã‚’è‡ªå‹•åŒ–ã™ã‚‹ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚ã“ã®Terraformã‚³ãƒ¼ãƒ‰ã¯ã€PaddiãŒæ¤œå‡ºã™ã¹ã**æ„å›³çš„ã«è„†å¼±ãªç’°å¢ƒ**ã‚’ãƒ¯ãƒ³ã‚³ãƒãƒ³ãƒ‰ã§æ§‹ç¯‰ã—ã¾ã™ã€‚

### ä½œæˆã•ã‚Œã‚‹è„†å¼±æ€§ï¼ˆãƒ‡ãƒ¢ç”¨ï¼‰

1. **éå‰°ãªIAMæ¨©é™**
   - Owneræ¨©é™ã‚’æŒã¤ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ
   - Editoræ¨©é™ã‚’æŒã¤ä¸è¦ãªã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ
   - é•·æœŸé–“æœ‰åŠ¹ãªã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚­ãƒ¼

2. **å…¬é–‹ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸**
   - allUsersã«å…¬é–‹ã•ã‚ŒãŸãƒã‚±ãƒƒãƒˆ
   - æ©Ÿå¯†ãƒ‡ãƒ¼ã‚¿ï¼ˆãƒ€ãƒŸãƒ¼ï¼‰ã‚’å«ã‚€å…¬é–‹ãƒã‚±ãƒƒãƒˆ
   - APIã‚­ãƒ¼ï¼ˆãƒ€ãƒŸãƒ¼ï¼‰ã‚’å«ã‚€è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«

3. **Vertex AIç’°å¢ƒ**
   - Paddiå®Ÿè¡Œç”¨ã®ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¨æ¨©é™

## ğŸš€ ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ

### å‰ææ¡ä»¶

- Terraform >= 1.0
- Google Cloud SDK (gcloud)
- æœ‰åŠ¹ãªGCPãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ
- é©åˆ‡ãªæ¨©é™ï¼ˆProject Editorä»¥ä¸Šï¼‰

### ãƒ‡ãƒ—ãƒ­ã‚¤æ‰‹é †

```bash
# 1. è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’æº–å‚™
cd terraform/environments/demo
cp terraform.tfvars.example terraform.tfvars
vim terraform.tfvars  # project_id ã‚’è¨­å®š

# 2. ãƒ‡ãƒ—ãƒ­ã‚¤å®Ÿè¡Œï¼ˆ5åˆ†ç¨‹åº¦ï¼‰
../../scripts/deploy.sh

# 3. Paddiã§ç›£æŸ»å®Ÿè¡Œ
cd ../../..
python main.py audit --project-id YOUR_PROJECT_ID
```

### ç’°å¢ƒå‰Šé™¤

```bash
# ã‚³ã‚¹ãƒˆå‰Šæ¸›ã®ãŸã‚ã€ä½¿ç”¨å¾Œã¯å¿…ãšå‰Šé™¤ã—ã¦ãã ã•ã„
cd terraform/environments/demo
../../scripts/destroy.sh
```

## ğŸ“ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 

```
terraform/
â”œâ”€â”€ environments/          # ç’°å¢ƒåˆ¥è¨­å®š
â”‚   â”œâ”€â”€ demo/             # ãƒ‡ãƒ¢ç’°å¢ƒ
â”‚   â””â”€â”€ hackathon/        # ãƒãƒƒã‚«ã‚½ãƒ³ç’°å¢ƒ
â”œâ”€â”€ modules/              # å†åˆ©ç”¨å¯èƒ½ãªãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«
â”‚   â”œâ”€â”€ vulnerable-iam/   # è„†å¼±ãªIAMè¨­å®š
â”‚   â”œâ”€â”€ public-storage/   # å…¬é–‹ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸
â”‚   â””â”€â”€ vertex-ai/        # Vertex AIè¨­å®š
â””â”€â”€ scripts/              # è‡ªå‹•åŒ–ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
    â”œâ”€â”€ deploy.sh         # ãƒ‡ãƒ—ãƒ­ã‚¤ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
    â””â”€â”€ destroy.sh        # å‰Šé™¤ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
```

## âš™ï¸ è¨­å®šã‚ªãƒ—ã‚·ãƒ§ãƒ³

`terraform.tfvars` ã§ä»¥ä¸‹ã®è¨­å®šãŒå¯èƒ½ï¼š

```hcl
# å¿…é ˆ
project_id = "your-gcp-project-id"

# ã‚ªãƒ—ã‚·ãƒ§ãƒ³
region                = "asia-northeast1"
environment           = "demo"
enable_auto_destroy   = true              # è‡ªå‹•å‰Šé™¤ã‚’æœ‰åŠ¹åŒ–
auto_destroy_schedule = "0 2 * * *"       # æ¯æ—¥åˆå‰2æ™‚ã«å‰Šé™¤
```

## ğŸ’° ã‚³ã‚¹ãƒˆç®¡ç†

- **è‡ªå‹•å‰Šé™¤æ©Ÿèƒ½**: æŒ‡å®šæ™‚åˆ»ã«ç’°å¢ƒã‚’è‡ªå‹•å‰Šé™¤
- **ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ãƒ«ãƒ¼ãƒ«**: ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã¯7æ—¥å¾Œã«è‡ªå‹•å‰Šé™¤
- **æ¨å®šã‚³ã‚¹ãƒˆ**: 1æ—¥ã‚ãŸã‚Š$5-10ç¨‹åº¦ï¼ˆä½¿ç”¨é‡ã«ã‚ˆã‚‹ï¼‰

## âš ï¸ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è­¦å‘Š

ã“ã®Terraformã‚³ãƒ¼ãƒ‰ã¯**æ•™è‚²ãƒ»ãƒ‡ãƒ¢ç›®çš„**ã§æ„å›³çš„ã«è„†å¼±ãªç’°å¢ƒã‚’ä½œæˆã—ã¾ã™ï¼š

- âŒ æœ¬ç•ªç’°å¢ƒã§ã¯çµ¶å¯¾ã«ä½¿ç”¨ã—ãªã„ã§ãã ã•ã„
- âŒ å®Ÿéš›ã®ãƒ‡ãƒ¼ã‚¿ã‚’é…ç½®ã—ãªã„ã§ãã ã•ã„
- âœ… ä½¿ç”¨å¾Œã¯å¿…ãšç’°å¢ƒã‚’å‰Šé™¤ã—ã¦ãã ã•ã„

## ğŸ”§ ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### APIãŒæœ‰åŠ¹åŒ–ã•ã‚Œã¦ã„ãªã„ã‚¨ãƒ©ãƒ¼

```bash
# å¿…è¦ãªAPIã‚’æ‰‹å‹•ã§æœ‰åŠ¹åŒ–
gcloud services enable compute.googleapis.com
gcloud services enable storage.googleapis.com
gcloud services enable iam.googleapis.com
gcloud services enable aiplatform.googleapis.com
```

### æ¨©é™ã‚¨ãƒ©ãƒ¼

```bash
# ç¾åœ¨ã®èªè¨¼æƒ…å ±ã‚’ç¢ºèª
gcloud auth list

# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’è¨­å®š
gcloud config set project YOUR_PROJECT_ID
```

### TerraformçŠ¶æ…‹ãƒ•ã‚¡ã‚¤ãƒ«ã®ç ´æ

```bash
# ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‹ã‚‰å¾©å…ƒ
cd terraform/environments/demo
cp backups/æœ€æ–°ã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—/terraform.tfstate ./
```

## ğŸ“š å‚è€ƒè³‡æ–™

- [Terraform Google Provider](https://registry.terraform.io/providers/hashicorp/google/latest/docs)
- [GCP IAMãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹](https://cloud.google.com/iam/docs/best-practices)
- [Paddiãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ](https://github.com/susumutomita/Paddi)